
<script>
document.addEventListener("DOMContentLoaded", () => {
    console.log("ğŸ“» Skript spuÅ¡tÄ›n â€“ ÄekÃ¡m na jPlayer...");

    if (window.jQuery && jQuery().jPlayer) {
        console.log("âœ… jPlayer je naÄten");

        const player = jQuery(".jp-jplayer");

        if (player.length > 0) {
            console.log("â–¶ï¸ HledÃ¡m pÅ™ehrÃ¡vaÄ... nalezen");

            // MP3 pÅ™ehrÃ¡vÃ¡
            player.bind($.jPlayer.event.playing, function () {
                console.log("âœ… MP3 se pÅ™ehrÃ¡vÃ¡ â€“ posÃ­lÃ¡m OK");
                window.parent.postMessage({ fm_status: "ok" }, "*");
            });

            // Chyba pÅ™i pÅ™ehrÃ¡nÃ­
            player.bind($.jPlayer.event.error, function (e) {
                console.log("âŒ Chyba jPlayeru:", e.jPlayer.error.type);
                window.parent.postMessage({ fm_status: "fail" }, "*");
            });

            // ZjiÅ¡tÄ›nÃ­, Å¾e je MP3 skuteÄnÄ› naÄtena (loadedmetadata)
            player.bind($.jPlayer.event.loadeddata, function (e) {
                const dur = player.data("jPlayer").status.duration;
                if (dur > 0) {
                    console.log("ğŸµ MP3 naÄtena, dÃ©lka:", dur, "sekund");
					window.parent.postMessage({ mp3_status: "ok" }, "*");

                } else {
                    console.log("âš ï¸ MP3 nebyla sprÃ¡vnÄ› naÄtena (duration = 0)");
                    window.parent.postMessage({ fm_status: "fail" }, "*");
                }
            });

            // ZkusÃ­me automatickÃ© pÅ™ehrÃ¡nÃ­
            console.log("ğŸ”ˆ Pokus o pÅ™ehrÃ¡nÃ­ s hlasitostÃ­ 0");
            player.jPlayer("volume", 0).jPlayer("play");

        } else {
            console.warn("âš ï¸ .jp-jplayer nenalezen â€“ kontrola chybovÃ©ho textu");
            const errCheck = setInterval(() => {
                if (document.body.innerText.includes("Sorry, we couldn't find the requested track")) {
                    clearInterval(errCheck);
                    console.log("âŒ TextovÃ¡ chyba detekovÃ¡na â€“ posÃ­lÃ¡m FAIL");
                    window.parent.postMessage({ fm_status: "fail" }, "*");
                }
            }, 500);
            setTimeout(() => {
                clearInterval(errCheck);
                console.log("ğŸ•’ Konec ÄekÃ¡nÃ­ na chybovÃ½ text");
            }, 5000);
        }
    } else {
        console.warn("â— jPlayer nenalezen â€“ posÃ­lÃ¡m FAIL");
        window.parent.postMessage({ fm_status: "fail" }, "*");
    }
});
</script>