<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>FM Player Detektor</title>
  <style>
    body { margin: 0; background: black; }
    .player {
      width: 940px;
      height: 128px;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 20px 10px black;
    }
  </style>
</head>
<body>

<div id="playerContainer"></div>

<script>
  const container = document.getElementById('playerContainer');
  const PRIMARY_URL = "https://fmcloud.pro/embed.php?id=347";
  const BACKUP_URL = "https://trolltrolli.github.io/skt/popis/hl2/player_backup.html";

  function createIframe(src) {
    const iframe = document.createElement('iframe');
    iframe.className = 'player';
    iframe.src = src;
    iframe.allow = "autoplay";
    return iframe;
  }

  function analyzeFrameContent(iframe) {
    try {
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      
      // LogovÃ¡nÃ­ zÃ¡kladnÃ­ch informacÃ­
      console.log("=== FMCloud Diagnostika ===");
      console.log("URL iframe:", doc.location.href);
      console.log("Title strÃ¡nky:", doc.title);
      
      // Detekce specifickÃ½ch prvkÅ¯
      const playerElements = doc.querySelectorAll('audio, video, .player-wrapper, #player');
      console.log("PoÄet detekovanÃ½ch pÅ™ehrÃ¡vaÄovÃ½ch prvkÅ¯:", playerElements.length);
      
      // Kontrola chybovÃ½ch hlÃ¡Å¡ek
      const errorText = doc.body?.textContent?.includes('error') 
        || doc.body?.innerHTML?.includes('nedostupn');
      console.log("Detekce chybovÃ© hlÃ¡Å¡ky:", errorText ? 'ANO' : 'NE');

      return playerElements.length > 0;
    } catch (e) {
      console.warn("CORS chyba pÅ™i analÃ½ze obsahu:", e.message);
      return false;
    }
  }

  async function loadPlayer() {
    console.log("ðŸ Startuji naÄÃ­tÃ¡nÃ­ FMCloud...");
    const primaryIframe = createIframe(PRIMARY_URL);
    container.appendChild(primaryIframe);

    // ÄŒekÃ¡me na naÄtenÃ­ iframe
    await new Promise(resolve => primaryIframe.onload = resolve);
    console.log("âœ… FMCloud iframe naÄten");

    // AnalÃ½za obsahu
    const hasPlayer = analyzeFrameContent(primaryIframe);
    
    if(hasPlayer) {
      console.log("ðŸŽ¯ PÅ™ehrÃ¡vaÄ byl detekovÃ¡n v iframe!");
    } else {
      console.warn("âš ï¸ PÅ™ehrÃ¡vaÄ nebyl nalezen! SpouÅ¡tÃ­m zÃ¡loÅ¾nÃ­...");
      container.removeChild(primaryIframe);
      container.appendChild(createIframe(BACKUP_URL));
      console.log("ðŸ”„ ZÃ¡loÅ¾nÃ­ pÅ™ehrÃ¡vaÄ aktivovÃ¡n");
    }
  }

  // SpuÅ¡tÄ›nÃ­ s oÅ¡etÅ™enÃ­m chyb
  loadPlayer().catch(err => {
    console.error("ðŸ’¥ KritickÃ¡ chyba:", err);
    container.innerHTML = '';
    container.appendChild(createIframe(BACKUP_URL));
  });
</script>

</body>
</html>
